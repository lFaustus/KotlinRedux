buildscript {
  project.apply from: "${rootDir}/constants.gradle"
  project.apply from: "${rootDir}/android/constants.gradle"

  repositories {
    google()
    jcenter()
  }

  dependencies {
    classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin"
    classpath "com.android.tools.build:gradle:$project.ext.gradle"
    classpath "com.github.dcendents:android-maven-gradle-plugin:$androidMavenGradle"
  } 
}

plugins {
  id 'org.jetbrains.kotlin.jvm' version '1.3.11'
  id 'com.github.kt3k.coveralls' version '2.8.2'
}

repositories {
  google()
  jcenter()
}

subprojects {
  repositories {
    google()
    jcenter()
  }
  
  apply plugin: 'com.android.library'
  apply plugin: 'kotlin-android'
  apply plugin: 'com.github.dcendents.android-maven'

  project.apply from: "${rootDir}/constants.gradle"
  project.apply from: "${rootDir}/android/constants.gradle"
  group = 'com.github.protoman92'
  version '1.0-SNAPSHOT'

  configurations.all {
    // Make sure the latest JitPack releases are used.
    resolutionStrategy.cacheChangingModulesFor 24, 'hours'
  }

  android {
    compileSdkVersion compileSdk

    defaultConfig {
      minSdkVersion minSdk
      targetSdkVersion targetSdk
      versionCode versionCode
      versionName versionName

      testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"
    }

    buildTypes {
      release {
        minifyEnabled false
        proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
      }
    }
  }

  dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])

    implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin"
    implementation "androidx.appcompat:appcompat:$appCompat"
    testImplementation "junit:junit:$junit"
    androidTestImplementation "androidx.test:runner:$testRunner"
    androidTestImplementation "androidx.test.espresso:espresso-core:$espresso"
  }

  test {
    testLogging  {
      // showing skipped occasionally should prevent CI timeout due to lack of standard output
      events=["skipped", "failed"] // "started", "passed"
      // showStandardStreams = true
      exceptionFormat="full"

      debug.events = ["skipped", "failed"]
      debug.exceptionFormat="full"

      info.events = ["failed", "skipped"]
      info.exceptionFormat="full"

      warn.events = ["failed", "skipped"]
      warn.exceptionFormat="full"
    }

    maxHeapSize = project.ext.testHeapSize
    useTestNG()
  }
}

project('core') {
  dependencies {
    api project(':common:core')
    api project(':common:ui')
  }
}

project('livedata-rx-saga') {
  dependencies {
    api project(':common:rx-saga')
    implementation "androidx.lifecycle:lifecycle-livedata:$lifecycle"
    implementation "androidx.lifecycle:lifecycle-reactivestreams:$lifecycle"
    annotationProcessor "androidx.lifecycle:lifecycle-compiler:$lifecycle"
  }
}

project('recycler-view') {
  dependencies {
    api project(':android:core')
    implementation "androidx.recyclerview:recyclerview:$recyclerView"
  }
}

project('router') {
  dependencies {
    api project(':common:core')
    api project(':common:router')
  }
}
